{extend name="layout/base"}
{block name="main"}
<!--左栏-->
<div class="left">
    <ul class="cl">
        <!--顶级分类-->
        <li v-for="vo,index in menu" :class="{hidden:vo.hidden}">
            <a href="javascript:;" :class="{active:vo.active}" @click="onActive(index)">
                <i class="layui-icon" v-html="vo.icon"></i>
                <span v-text="vo.name"></span>
                <i class="layui-icon arrow" v-show="vo.url.length==0">&#xe61a;</i> <i v-show="vo.active"
                                                                                      class="layui-icon active">&#xe623;</i>
            </a>
            <!--子级分类-->
            <div v-for="vo2,index2 in vo.list">
                <a href="javascript:;" :class="{active:vo2.active}" @click="onActive(index,index2)"
                   v-text="vo2.name"></a>
                <i v-show="vo2.active" class="layui-icon active">&#xe623;</i>
            </div>
        </li>
    </ul>
</div>
<!--右侧-->
<div class="right">
    <a href="/admin/cate/create" class="layui-btn"><i class="layui-icon">&#xe654;</i>添加栏目</a>
    <table class="layui-table layui-form">
        <colgroup>
            <col width="80">
            <col width="80">
            <col width="150">
            <col width="80">
            <col width="80">
            <col width="80">
            <col>
            <col width="150">
        </colgroup>
        <thead>
        <tr>
            <th>ID</th>
            <th>排序</th>
            <th>名称</th>
            <th>显示</th>
            <th>创建时间</th>
            <th>操作</th>
        </tr>
        </thead>
        <tbody>
        {foreach $categorys as $key=>$vo }
        <tr class="id9">
            <td>{$vo.id}</td>
            <td><input onblur="updateSort({$vo.id},this.value)" type="text" style="width: 4em" value="{$vo.sort}"
                       name="" id="" class="layui-input"></td>
            <td>{$vo.name}</td>
            <td><input data-id="{$vo.id}" lay-filter="state" type="checkbox" {if $vo.state eq 1} checked {/if}
                lay-text="开启|关闭" lay-skin="switch">
            </td>
            <td>{$vo.create_time}</td>
            <td>
                <a href="/admin/cate/{$vo.id}/edit">修改</a> |
                <a class="" href="javascript:;" onclick="deleteCate({$vo.id})">删除</a></td>
        </tr>
        {/foreach}
        </tbody>
    </table>
    <div class="page">
        {$categorys|raw}
    </div>
</div>
{/block}
{block name="script"}
<script>
    function deleteCate(id) {
        layer.alert('确认删除？', function (index) {
            $.post('/admin/cate/' + id, {_method: 'DELETE'}, res => {
                if (res.code === 1) {
                    layer.msg(res.msg, {icon: 6, time: 1500}, () => {
                        location.href = res.url
                    })
                } else {
                    layer.msg(res.msg, {icon: 5, time: 1500}, () => {
                        location.href = res.url
                    })
                }
            })
            layer.close(index);
        });
        return false;
    }

    function updateSort(id, value) {
        $.post('/admin/cate/up_sort/' + id, {sort: value}, res => {
            if (res.code === 1) layer.msg(res.msg, {icon: 6, time: 900, anim: 2}, () => {
                location.href = res.url
            })
            else layer.msg(res.msg, {icon: 5, time: 1000, anim: 6})
        })
    }

    layui.use('form', function () {
        const form = layui.form, layer = layui.layer, $ = layui.jquery;

        form.on('switch(state)', function (data) {
            const id = $(data.elem).attr("data-id");
            const value = $(data.elem).attr("value") === '1' ? 0 : 1;
            $.post('/admin/cate/up_state/' + id, {status: value}, res => {
                if (res.code === 1) layer.msg(res.msg, {icon: 6, time: 900, anim: 2})
                else layer.msg(res.msg, {icon: 5, time: 1000, anim: 6})
            })
        });
    });


</script>
{/block}